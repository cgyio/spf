/**
 * SPF-Theme 主题系统配套 scss
 * 此 SCSS 不处理 import 如需引入外部样式，应在 *.theme.json 中指定 styles.import 参数
 * !! 不要手动修改 !!
 * 
 * SPF-Theme 主题系统变量：
 *      $colorListAll                       全部颜色名称 list：red,orange,yellow,...,fc,bgc,bdc,...,primary,...
 *      $colorListBase|Static|Custom...     不同类型的 颜色名称 list
 *      $colorShiftQueue                    d3,d2,d1,m,l1,l2,l3
 *      $colorMap                           包含所有颜色定义的 map
 *      $typeList                           primary,danger,warn,success,info
 *      $effectList                         normal,fill,plain,popout
 *      $sizeMap                            包含所有尺寸定义的 map
 *      $sizeShiftQueue                     xxs,xs,s,m,l,xl,xxl
 *      $sizeStrQueue                       huge,large,medium,normal,small,mini,tiny
 *      $sizeStrMap                         尺寸字符串 与 m|xl 映射 map
 *      $extra[Icon|Btn]SizeQueue           icon|btn 额外的尺寸序列 48,54,64,...,128
 *      $shapeList                          normal,pill,sharp
 *      $stretchList                        square,normal,row
 *      $tightnessList                      loose,normal,tight
 *      $varsMap                            保存所有其他 css 变量的 map
 */

/**
 * !! 检查是否存在 dart-scss-patch 文件内容
 */
$is-patched: variable-exists(dartScssTypeList);

.test {
$sk: mg;
padding: size-get(#{$sk}-xxs, null);
}


/** SPF-Theme 主题变量 **/
//status 状态可选列表
$spfStatusList: normal,hover,active;

/** SPF-Theme 主题变量计算函数 **/
//根据单行元素的 height 计算 padding|radius|font-size  <返回：map>
@function spf-bar-calc($size: bar-m) {
    $rtn: (
        sz: null,
        pd: null,
        rd: null,
        fs: null
    );
    $sz: size-get($size);
    @if not is-number($sz) {@return $rtn;}
    $rtn: map.set($rtn, sz, $sz);
    $rtn: map.set($rtn, pd, round(div($sz, 2)));
    $rtn: map.set($rtn, rd, round(div($sz, 5)));
    $rtn: map.set($rtn, fs, round(div($sz, 2)));
    @return $rtn;
}


/** 通用样式注入 mixins **/

/** 基础样式注入 position|width|padding|overflow ... **/
@mixin spf-po($po: relative, $w: 100%, $h: unset, $mg: 0, $pd: 0, $t: unset, $r: unset, $b: unset, $l: unset, $ov: unset) {
    position: $po;
    @if $w != unset { width: size-get($w); }
    @if $h != unset { height: size-get($h); }
    @if $mg != unset { margin: size-get($mg); }
    @if $pd != unset { padding: size-get($pd); }
    @if $l != unset { left: size-get($l); }
    @if $r != unset { right: size-get($r); }
    @if $t != unset { top: size-get($t); }
    @if $b != unset { bottom: size-get($b); }
    @if $ov != unset { overflow: $ov; }
    box-sizing: border-box;
}
@mixin spf-po-ov($po: relative, $w: 100%, $h: unset, $mg: 0, $pd: 0, $t: unset, $r: unset, $b: unset, $l: unset, $ov: hidden) {
    @include spf-po($po, $w, $h, $mg, $pd, $t, $r, $b, $l, $ov);
}
@mixin spf-po-abs($w: 100%, $h: unset, $mg: 0, $pd: 0, $t: 0, $r: unset, $b: unset, $l: 0, $ov: hidden) {
    @include spf-po(absolute, $w, $h, $mg, $pd, $t, $r, $b, $l, $ov);
}
@mixin spf-po-fix($w: 100%, $h: unset, $mg: 0, $pd: 0, $t: 0, $r: unset, $b: unset, $l: 0, $ov: hidden) {
    @include spf-po(fixed, $w, $h, $mg, $pd, $t, $r, $b, $l, $ov);
}
/** 基础样式注入 根据输入的 trbl 设置不同 position 位置的 padding/margin/border-width size **/
/** $p 可选值：$trblQueue **/
@mixin spf-size-po(
    $size:      unset,              //要设置的尺寸 
    $p:         '',                 //要设置尺寸值的 position 位置，可选值：$trblQueue，默认不指定，表示所有位置
    $prop:      padding,            //要设置尺寸值的 css 属性，默认 padding，可选 padding/margin/border-width
    $important: false               //是否增加 important
) {
    @if $p != '' {
        $pa: trbl($p);
        @if is-list($pa) {
            @each $pi in $pa {
                $pk: #{$prop}-#{$pi};
                @if $prop == border-width {
                    $pk: border-#{$pi}-width;
                }
                @if $important == true {
                    #{$pk}: $size !important;
                } @else {
                    #{$pk}: $size;
                }
            }
        }
    } @else {
        @if $important == true {
            #{$pk}: $size !important;
        } @else {
            #{$pk}: $size;
        }
    }
}
/** 基础样式注入 根据输入的 corner 设置不同位置的 radius size **/
/** $r 可选值：$cornerQueue **/
@mixin spf-size-rd(
    $size:      unset,              //要设置的尺寸 
    $r:         '',                 //要设置尺寸值的 corner 位置，可选值：$cornerQueue，默认不指定，表示所有位置
    $important: false               //是否增加 important
) {
    @if $r != '' {
        $ra: corner($r);
        @if is-list($ra) {
            @each $ri in $ra {
                $prop: border-#{$ri}-radius;
                @if $important == true {
                    #{$prop}: $size !important;
                } @else {
                    #{$prop}: $size;
                }
            }
        }
    } @else {
        @if $important == true {
            border-radius: $size !important;
        } @else {
            border-radius: $size;
        }
    }
}
/** 基础样式注入 flex 布局 **/
@mixin spf-flex($dir: row, $x: flex-start, $y: center, $gap: unset, $inner: true) {
    display: flex; flex-direction: $dir;
    @if $dir == row {
        align-items: $y; justify-content: $x;
    } @else {
        align-items: $x; justify-content: $y;
    }

    //自动生成内部子样式类
    @if $inner == true {
        @for $i from 1 through 8 {
            &>.flex-#{$i} {
                $wh: if($dir == column, height, width);
                #{$wh}: unset;
                flex: $i;
            }
        }
    
        &.flex-no-shrink {
            &>*, &>view {
                flex-shrink: 0;
            }
        }
    
        &.flex-with-gap {
            $gap-side: if($dir == column, top, left);
            @if $gap != unset {
                $gap: size-get($gap);
                @if is-number($gap) {
                    &>*, &>view {
                        &:not(:first-child) {
                            margin-#{$gap-side}: $gap;
                        }
                    }
                }
            }
            @each $qi in $sizeShiftQueue {
                $gapi: size-get(mg-#{$qi});
                @if is-number($gapi) {
                    &.flex-gap-#{$qi} {
                        &>*, &>view {
                            &:not(:first-child) {
                                margin-#{$gap-side}: $gapi;
                            }
                        }
                    }
                }
            }
        }
    
        &.flex-center {justify-content: center; align-items: center;}
        &.flex-start {justify-content: flex-start; align-items: flex-start;}
        &.flex-end {justify-content: flex-end; align-items: flex-end;}
        &.flex-stretch {justify-content: stretch; align-items: stretch;}
    
        &[class*=flex-x-] {
            $prop: if($dir == column, align-items, justify-content);
            &[class*=x-center] {#{$prop}: center;}
            &[class*=x-start] {#{$prop}: flex-start;}
            &[class*=x-end] {#{$prop}: flex-end;}
            &[class*=x-stretch] {#{$prop}: stretch;}
        }
        &[class*=flex-y-] {
            $prop: if($dir == row, align-items, justify-content);
            &[class*=y-center] {#{$prop}: center;}
            &[class*=y-start] {#{$prop}: flex-start;}
            &[class*=y-end] {#{$prop}: flex-end;}
            &[class*=y-stretch] {#{$prop}: stretch;}
        }
    }
}
@mixin spf-flex-x($x: flex-start, $y: center, $gap: unset) {
    @include spf-flex(row, $x, $y, $gap, true);
}
@mixin spf-flex-y($x: flex-start, $y: flex-start, $gap: unset) {
    @include spf-flex(column, $x, $y, $gap, true);
}
@mixin spf-flex-x-noinner($x: flex-start, $y: center, $gap: unset) {
    @include spf-flex(row, $x, $y, $gap, false);
}
@mixin spf-flex-y-noinner($x: flex-start, $y: flex-start, $gap: unset) {
    @include spf-flex(column, $x, $y, $gap, false);
}
/** 基础样式注入 链接样式 **/
@mixin spf-a($base: primary, $important: false) {
    text-decoration: underline;
    text-underline-offset: 0.3em;
    transition: color $ani-dura,
                text-underline-offset .1s;

    &:hover {
        text-underline-offset: 0.2em;
    }

    $bk: #{$base}-m;
    $bc: color-get($bk);
    $hc: color-get(color-key-shift($bk, l1));
    $ac: color-get(color-key-shift($bk, d1));
    @if is-color($bc, $hc, $ac) {
        @if $important == true {
            color: $bc !important;
            &:hover {
                color: $hc !important;
            }
            &:visited, &[class*=active] {
                color: $ac !important;
            }
        } @else {
            color: $bc;
            &:hover {
                color: $hc;
            }
            &:visited, &[class*=active] {
                color: $ac;
            }
        }
    }
}
/** 基础样式注入 text-ellipsis 样式 **/
@mixin spf-text-ellipsis() {
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
}
/** 基础样式注入 模拟移动端滚动条效果 **/
@mixin spf-scroll(
    $size:      6px,            //滚动条宽度
    $fc:        bdc-d1,         //滚动条背景色，传入可通过 color-get 方法获取色值的 颜色键名|transparent
    $fc-hover:  bdc-d2,         //滚动条悬停背景色，传入可通过 color-get 方法获取色值的 颜色键名|transparent
    $bgc:       transparent,    //滚动轨道背景色，传入可通过 color-get 方法获取色值的 颜色键名|transparent
    $ov:        hidden auto,    //垂直|水平 滚动条显示
    $round:     false,          //滚动条是否圆角
    $behavior:  smooth
) {
    $fcv: color-get($fc);
    $fchv: color-get($fc-hover);
    $bgcv: color-get($bgc);

    overflow: $ov;
    scroll-behavior: $behavior;
    /* 滚动条占位宽度 = 0，内容区域 100 % */
    scrollbar-gutter: stable;

    &::-webkit-scrollbar {
        width: $size; 
        height: $size;
    }
    &::-webkit-scrollbar-track {background-color: $bgcv;}
    &::-webkit-scrollbar-thumb  {
        background-color: $fcv;
        cursor: ns-resize;
        transition: all .3s;

        @if $round == true {
            border-radius: $size / 2;
        }

        &:hover {background-color: $fchv;}
    }
    &::-webkit-scrollbar:horizontal {
        cursor: ew-resize;
    }

    /* iOS 惯性回弹必备 */
    //-webkit-overflow-scrolling: touch;
    /* 可选：隐藏系统默认箭头按钮 */
    //scrollbar-width: none;   /* Firefox 直接变窄，不占位 */
}
/** 复合样式注入 向 当前类|后代类 注入 effect 效果样式 **/
@mixin spf-effect(
    $target:    self,               //此 effect 样式应用到 self(当前引用的类) 或 child(当前引用类的后代类)，默认 self
    $pre:       btn-,               //将生成 pre-effect-normal|fill|plain|popout 系列样式类
    $base:      null,               //effect 样式的基础颜色键名 例如：red|primary
) {
    //当前类|后代类 的 类名前缀
    $epre: if($target == self, unquote("&.#{$pre}"), unquote("& .#{$pre}"));

    //根据 base 基础颜色 以及 effect 类型，确定 bgk|fk|bdk 
    $normal-ks: null;
    $fill-ks:   null;
    $plain-ks:  null;
    $popout-ks: null;
    @if not is-nemstr($base) or is-null(color-get(#{$base}-m)) {
        //未指定 base 基础颜色键名  使用默认颜色
        $normal-ks: (   bgk: bgc-m,     fk: fc-m,   bdk: bdc-m  );
        $fill-ks:   (   bgk: gray-m,    fk: unset,  bdk: unset  );
        $plain-ks:  (   bgk: white-m,   fk: fc-m,   bdk: bdc-m  );
        $popout-ks: (   bgk: transparent,   fk: fc-m,   bdk: unset  );
    } @else {
        $bk: #{$base}-m;
        $normal-ks: (   bgk: #{$base}-l2,   fk: unset,  bdk: #{$base}-l1    );
        $fill-ks:   (   bgk: $bk,           fk: unset,  bdk: unset  );
        $plain-ks:  (   bgk: white-m,       fk: $bk,    bdk: $bk    );
        $popout-ks: (   bgk: transparent,   fk: $bk,    bdk: unset  );
    }
    //构建 不同 effect 类型下的 颜色键名 map
    $ks: (
        normal: $normal-ks,
        fill:   $fill-ks,
        plain:  $plain-ks,
        popout: $popout-ks,
    );

    //当前 base 颜色下的 默认样式，与 effect-normal 样式一致
    @if $target == self {
        $nksmap: map.get($ks, normal);
        @if is-map($ksmap) and not is-empty($ksmap) {
            $bgk:   map.get($nksmap, bgk);
            $fk:    map.get($nksmap, fk);
            $bdk:   map.get($nksmap, bdk);
            //status == normal
            @include spf-set-effect-with-status(normal, $bgk, $fk, $bdk);
            //status == hover
            &.#{$pre}hoverable:hover {
                @include spf-set-effect-with-status(hover, $bgk, $fk, $bdk);
            }
            //status == active
            &.#{$pre}active {
                @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                //覆盖 hover 样式，防止 active 状态下还有 hover 翻转效果
                &.#{$pre}hoverable:hover {
                    @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                }
            }
            //disabled 情况下的 status
            &.#{$pre}disabled {
                opacity: 0.6 !important;
                //status == normal
                @include spf-set-effect-with-status(normal, $bgk, $fk, $bdk);
                //status == hover 覆盖 hover 效果
                &.#{$pre}hoverable:hover {
                    @include spf-set-effect-with-status(normal, $bgk, $fk, $bdk);
                }
                //status == active
                &.#{$pre}active {
                    @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                    //覆盖 hover 样式，防止 active 状态下还有 hover 翻转效果
                    &.#{$pre}hoverable:hover {
                        @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                    }
                }
            }
        }
    }

    //effect 循环
    @each $efi in $effectList {
        $ksmap: map.get($ks, $efi);
        @if is-map($ksmap) and not is-empty($ksmap) {
            $bgk:   map.get($ksmap, bgk);
            $fk:    map.get($ksmap, fk);
            $bdk:   map.get($ksmap, bdk);
            #{$epre}effect-#{$efi} {
                //status == normal
                @include spf-set-effect-with-status(normal, $bgk, $fk, $bdk);
                //status == hover
                &.#{$pre}hoverable:hover {
                    @include spf-set-effect-with-status(hover, $bgk, $fk, $bdk);
                }
                //status == active
                &.#{$pre}active {
                    @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                    //覆盖 hover 样式，防止 active 状态下还有 hover 翻转效果
                    &.#{$pre}hoverable:hover {
                        @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                    }
                }
                //disabled 情况下的 status
                &.#{$pre}disabled {
                    opacity: 0.6 !important;
                    //status == normal
                    @include spf-set-effect-with-status(normal, $bgk, $fk, $bdk);
                    //status == hover 覆盖 hover 效果
                    &.#{$pre}hoverable:hover {
                        @include spf-set-effect-with-status(normal, $bgk, $fk, $bdk);
                    }
                    //status == active
                    &.#{$pre}active {
                        @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                        //覆盖 hover 样式，防止 active 状态下还有 hover 翻转效果
                        &.#{$pre}hoverable:hover {
                            @include spf-set-effect-with-status(active, $bgk, $fk, $bdk);
                        }
                    }
                }
            }
        }
    }
}
/** 复合样式注入 根据 status 状态注入 effect 样式的实际 background-color|border-color|color 样式值 **/
@mixin spf-set-effect-with-status(
    $status:    normal,             //状态值 可选：normal|hover|active
    $bgk:       unset,              //背景色 实际样式值  string 类型颜色键名 | unset
    $fk:        unset,              //前景色 实际样式值  string 类型颜色键名 | unset
    $bdk:       unset               //边框色 实际样式值  string 类型颜色键名 | unset
) {
    @if not is-nemstr($status) or not has($spfStatusList, $status, true) {
        $status: normal;
    }
    
    @if $status == normal {
        //normal 状态
        @include spf-set-effect($bgk, $fk, $bdk);
    } @else if $status == hover {
        //hover 状态，所有颜色减淡一级
        $h-bgk: unset;
        $h-fk:  unset;
        $h-bdk: unset;
        @if $bgk == transparent {
            //背景为 transparent 只有在 popout effect 情况下出现
            @if $fk == unset {
                $h-bgk: fc-m;
            } @else {
                $h-bgk: $fk;
            }
        } @else {
            //正常的背景翻转，前景跟随
            @if $bgk != unset {$h-bgk: color-key-shift($bgk, l1);}
            @if $fk  != unset {$h-fk: color-key-shift($fk, l1);}
        }
        @if $bdk != unset {$h-bdk: color-key-shift($bdk, l1);}
        @if not is-nemstr($h-bgk) {$h-bgk: unset;}
        @if not is-nemstr($h-fk) {$h-fk: unset;}
        @if not is-nemstr($h-bdk) {$h-bdk: unset;}
        @include spf-set-effect($h-bgk, $h-fk, $h-bdk);
    } @else if $status == active {
        //active 选中状态，所有颜色加深一级
        $a-bgk: unset;
        $a-fk:  unset;
        $a-bdk: unset;
        @if $bgk == transparent {
            //背景为 transparent 只有在 popout effect 情况下出现
            @if $fk == unset {
                $a-bgk: fc-d1;
            } @else {
                $a-bgk: color-key-shift($fk, d1);
            }
        } @else {
            //正常的背景翻转，前景跟随
            @if $bgk != unset {$a-bgk: color-key-shift($bgk, d1);}
            @if $fk  != unset {$a-fk: color-key-shift($fk, d1);}
        }
        @if $bdk != unset {$a-bdk: color-key-shift($bdk, d1);}
        @if not is-nemstr($a-bgk) {$a-bgk: unset;}
        @if not is-nemstr($a-fk) {$a-fk: unset;}
        @if not is-nemstr($a-bdk) {$a-bdk: unset;}
        @include spf-set-effect($a-bgk, $a-fk, $a-bdk);
    }
}
/** 复合样式注入 注入 effect 样式的实际 background-color|border-color|color 样式值 **/
@mixin spf-set-effect(
    $bgk:       unset,              //背景色 实际样式值  string 类型颜色键名 | unset
    $fk:        unset,              //前景色 实际样式值  string 类型颜色键名 | unset
    $bdk:       unset,              //边框色 实际样式值  string 类型颜色键名 | unset
) {
    $bgc: null;
    $fc: null;
    $bdc: null;
    //background-color
    @if $bgk != unset {
        $tc: color-get($bgk);
        @if is-color($tc) {$bgc: $tc;}
    }
    //color
    @if $fk == unset {
        $tc: null;
        @if is-color($bgc) and $bgc != transparent {
            $tc: fore-color($bgc);
        } @else {
            $tc: color-get(fc-m);
        }
        @if is-color($tc) {$fc: $tc;}
    } @else {
        $tc: color-get($fk);
        @if is-color($tc) {$fc: $tc;}
    }
    //border-color
    @if $bdk != unset {
        $tc: color-get($bdk);
        @if is-color($tc) {$bdc: $tc;}
    }
    //设置样式
    @if is-color($bgc) {background-color: $bgc;}
    @if is-color($fc) {color: $fc;}
    @if is-color($bdc) {
        border: {
            style: solid;
            width: $size-bd-m;
            color: $bdc;
        }
    } @else {
        border: {
            style: solid;
            width: 0;
            color: transparent;
        }
    }
}
/** 复合样式注入 向 当前类|后代类 注入 单行元素的 size 相关样式 **/
@mixin spf-bar-size(
    $target:    self,               //此 size 样式应用到 self(当前引用的类) 或 child(当前引用类的后代类)，默认 self
    $pre:       btn-,               //将生成 pre-shape-normal|pill|sharp 系列样式类
    $skey:      btn-m,              //单行元素的 height 尺寸值在 sizeMap 中的键名 | number 尺寸值
    $shape:     false,              //是否生成 shape 系列样式
    $stretch:   false,              //是否生成 stretch 系列样式
    $tightness: false,              //是否生成 tightness 系列样式
) {
    //当前类|后代类 的 类名前缀
    $spre: if($target == self, unquote("&.#{$pre}"), unquote("& .#{$pre}"));
    //获取当前指定的实际尺寸值 number
    $size: size-get($skey);
    @if is-number($size) {
        //自动计算相关样式值
        $szmap: spf-bar-calc($size);
        $sz: map.get($szmap, sz);
        $pd: map.get($szmap, pd);
        $rd: map.get($szmap, rd);
        $fs: map.get($szmap, fs);
        @if is-number($sz, $pd, $rd, $fs) {
            //为当前类注入样式
            @if $target == self {
                height: $sz;
                padding: 0 $pd;
                font-size: $fs;
                &>*:not(:first-child) {
                    margin-left: $pd;
                    margin-right: 0;
                }
                //shape 默认
                @if $shape == true {
                    border-radius: $rd;
                }
                //stretch 默认
                @if $stretch == true {
                    min-width: $sz;
                    width: unset;
                }
                //tightness 默认
                @if $tightness == true {
                    
                }
            }
            //shape
            @if $shape == true {
                //构建当前 size 下的 border-radius 样式值
                $rds: (
                    normal: $rd,
                    pill:   round(div($sz, 2)),
                    sharp:  0,
                );
                //循环 shapeList
                @each $spi in $shapeList {
                    $rdi: map.get($rds, $spi);
                    @if is-number($rdi) {
                        #{$spre}shape-#{$spi} {
                            border-radius: $rdi;
                        }
                    }
                }
            }
            //stretch
            @if $stretch == true {
                //stretch == normal
                #{$spre}stretch-normal {
                    min-width: $sz;
                    width: unset;
                }
                //stretch == square
                #{$spre}stretch-square {
                    width: $sz;
                }
                //stretch == row
                #{$spre}stretch-row {
                    width: unset;
                    flex: 1;
                }
            }
            //tightness
            @if $tightness == true {
                //构建 tightness 与 padding值的 map 映射
                $pds: (
                    loose: round(mul($pd, 2)),
                    normal: $pd,
                    tight: round(div($pd, 2)),
                );
                //tightness 循环
                @each $ti in $tightnessList {
                    $pdv: map.get($pds, $ti);
                    @if is-number($pdv) {
                        #{$spre}tightness-#{$ti} {
                            //单行元素
                            padding: 0 $pdv;
                            //flex-x 内部元素
                            &>*:not(:first-child) {
                                margin-left: $pdv;
                                margin-right: 0;
                            }
                        }
                    }
                }
            }
        }
    }
}



/** 批量注入样式 **/

/** 根据 $list 颜色名称数组，为 当前类 或 后代类 指定颜色样式
    例如：
    .foo {
        @include spf-color-shift(
            $pre:       bg-,
            $target:    child,
            $prop:      background-color,
            $ckey:      bg,
            $opa:       true
        );
    }
    编译后：
    .foo * { background-color: color-bg; }  //如果存在 color-{ckey}
    .foo .bg-l1 { background-color: color-bg-l1; }
    .foo .bg-l2 { background-color: color-bg-l2; }
    .foo .bg-l1-a1 { background-color: color-bg-l1-a1; }  //透明度循环
    .foo .bg-l1-a2 { background-color: color-bg-l1-a2; }
    .foo .bg-red { background-color: color-red; }
    .foo .bg-red-hover { background-color: color-red; }
    .foo .bg-red-hover:hover { background-color: color-red-l1; }
    .foo .bg-red-l1 { background-color: color-red-l1; }
    .foo .bg-red-l2 { background-color: color-red-l2; }
    .foo .bg-red-l1-a1 { background-color: color-red-l1-a1; }  //透明度循环
    .foo .bg-red-l1-a2 { background-color: color-red-l1-a2; }
    .foo .bg-blue { background-color: color-blue; }
    .foo .bg-blue-l1 { background-color: color-blue-l1; }
    .foo .bg-blue-l2 { background-color: color-blue-l2; }
    .foo .bg-blue-l1-a1 { background-color: color-blue-l1-a1; }  //透明度循环
    .foo .bg-blue-l1-a2 { background-color: color-blue-l1-a2; }
**/
@mixin spf-color-shift(
    $target:    self,               //此颜色样式应用到 self(当前引用的类) 或 child(当前引用类的后代类)，默认 self
    $pre:       fc-,                //新增颜色样式的类前缀，如：fc- 则 生成类：.foo.fc-red-m | .foo .fc-red-m
    $prop:      color,              //要设置颜色的 css 属性，可选 color/border-color/background-color/... 默认 color
    $ckey:      fc,                 //$prop 属性的默认颜色名，如：background-color 的默认颜色名为 bgc ($color-bgc-*)
    $opa:       false,              //是否启用透明度，true 表示同时循环透明度
    $filter:    null                //是否在 colorMap 中筛选部分颜色值 作为循环数据源  颜色键名(前缀) list
) {
    
    $list:      $colorListAll;      //颜色名称 list 数组，默认 $colorListAll 通用色
    $cque:      $colorShiftQueue;   //储存所有颜色 shift 变化 lvl 的 list，如：l2,l1,d1,d2 默认 $colorShiftQueue
    //$alist:     $colorListAlpha;    //定义的透明度级数序列，默认 a1~a9
    //$amap:      $colorAlphaMap;     //储存所有透明序列的 map，默认 $colorAlphaMap
    //储存 所有|筛选部分 色值的 map，默认 $colorMap
    $cmap:      if(not is-list($filter), $colorMap, map-filter-keys($colorMap, $filter...));

    @each $c in $list {
        @each $cq in $cque {
            /**
            *  针对 $pre 与 颜色名称相同的 情况
            *  例如 $pre = fc- 颜色列表中又包含了 fc-m 颜色，则会生成 .fc-fc-m 颜色类
            *  此处解决这个问题
            */
            $ck: '';
            $ci: null;
            @if $ckey == $c {
                $ck: #{$cq};
                $ci: color-get(#{$c}-#{$cq}, null, $cmap);
            } @else {
                $ck: #{$c}-#{$cq};
                $ci: color-get($ck, null, $cmap);
            }
            @if $ci != null {
                @if $target == self {
                    &.#{$pre}#{$ck} { #{$prop}: #{$ci} !important; }
                } @else if $target == child {
                    & .#{$pre}#{$ck} { #{$prop}: #{$ci} !important; }
                }
                /** 判断 $ci 颜色值是否自带 透明度 自带透明度的颜色不执行透明度循环 **/
                /** 通过主题系统自动生成的 colorMap 一定是 hex 形式 **/
            }

            /** 针对 color-m 级别的颜色 自动通过 pre-hoverable 增加悬停翻转颜色样式 **/
            @if $cq == 'm' {
                /** hover 默认使用 color-l1 级颜色 **/
                $ci-hov: color-get(#{$c}-l1, null, $cmap);
                @if $ci-hov != null {
                    @if $target == self {
                        &.#{$pre}#{$ck}.#{$pre}hoverable { 
                            &:hover {
                                #{$prop}: #{$ci-hov} !important; 
                            }
                        }
                    } @else if $target == child {
                        & .#{$pre}#{$ck}.#{$pre}hoverable { 
                            &:hover {
                                #{$prop}: #{$ci-hov} !important; 
                            }
                        }
                    }
                }
            }
        }
    }
}
/** size-shift **/
/** 根据 $list 可选尺寸数组(如：xs,s,m,l,xl)，为 当前类 或 后代类 指定尺寸样式 **/
@mixin spf-size-shift(
    $target:    self,               //此颜色样式应用到 self(当前引用的类) 或 child(当前引用类的后代类)，默认 self
    $pre:       pd-,                //样式类前缀，如：pd- 则生成类：.foo.pd-xxl | .foo .pd-xs
    $prop:      padding,            //要设置尺寸的 css 属性，可选 padding/margin/font-size/border-width/border-radius... 默认 padding
    $skey:      pd,                 //在尺寸 map 中的键名前缀，如 fs|pd|mg|rd|btn...
    $manual:    null,               //手动通过数值指定尺寸 list 如：24,32,48,54
    $trbl:      true,               //是否自动循环输出 trbl position 参数
    $filter:    null                //是否在 sizeMap 中筛选部分尺寸值 作为循环数据源  尺寸键名(前缀) list
) {
    //需要执行 位置循环的 $prop list
    $props: padding,margin,border-width,border-radius;
    //根据 filter 筛选部分 尺寸值
    $smap: if(not is-list($filter), $sizeMap, map-filter-keys($sizeMap, $filter...));

    //主题系统生成的 sizeMap 一定包含 -m 原始尺寸
    $msz: size-get(#{$skey}-m, null, $smap);
    //获取当前尺寸值序列的单位 如：px 主题系统生成的 sizeMap 相同键名一定拥有相同单位
    $mu: if(not is-number($msz), '', unit($msz));

    @each $sz in $sizeShiftQueue {
        $si: size-get(#{$skey}-#{$sz}, null, $smap);
        @if $si != null {
            @if $target == self {
                &.#{$pre}#{$sz} {
                    #{$prop}: $si !important;
                }
            } @else if $target == child {
                & .#{$pre}#{$sz} {
                    #{$prop}: $si !important;
                }
            }
            /** 对于某些 prop 还需要执行 位置循环 **/
            @if $trbl == true and has($props, $prop, true) {
                @if $prop == border-radius {
                    /** 针对 radius 执行特殊循环 **/
                    @each $ri in $cornerQueue {
                        @if $target == self {
                            //&.rd-xs.rd-tl
                            &.#{$pre}#{$sz}.#{$pre}#{$ri} {
                                @include spf-size-rd($si, $ri, true);
                            }
                        } @else if $target == child {
                            //& .rd-xs.rd-br
                            & .#{$pre}#{$sz}.#{$pre}#{$ri} {
                                @include spf-size-rd($si, $ri, true);
                            }
                        }
                    }
                } @else {
                    /** 正常的 trbl 循环 **/
                    @each $pi in $trblQueue {
                        @if $target == self {
                            //&.pd-xs.pd-tbl
                            &.#{$pre}#{$sz}.#{$pre}#{$pi} {
                                @include spf-size-po($si, $pi, $prop, true);
                            }
                        } @else if $target == child {
                            //& .pd-xs.pd-tbl
                            & .#{$pre}#{$sz}.#{$pre}#{$pi} {
                                @include spf-size-po($si, $pi, $prop, true);
                            }
                        }
                    }
                }
            }
        }
    }

    //通过手动传入尺寸值，来设置尺寸样式
    @if is-list($manual) {
        @each $sz in $manual {
            @if $target == self {
                &.#{$pre}#{$sz}#{$mu} {
                    #{$prop}: #{$sz}#{$mu} !important;
                }
            } @else if $target == child {
                & .#{$pre}#{$sz}#{$mu} {
                    #{$prop}: #{$sz}#{$mu} !important;
                }
            }
            /** 对于某些 prop 还需要执行 位置循环 **/
            @if $trbl == true and has($props, $prop, true) {
                @if $prop == border-radius {
                    /** 针对 radius 执行特殊循环 **/
                    @each $ri in $cornerQueue {
                        @if $target == self {
                            //&.rd-16px.rd-tl
                            &.#{$pre}#{$sz}#{$mu}.#{$pre}#{$ri} {
                                @include spf-size-rd(#{$sz}#{$mu}, $ri, true);
                            }
                        } @else if $target == child {
                            //& .rd-16px.rd-br
                            & .#{$pre}#{$sz}#{$mu}.#{$pre}#{$ri} {
                                @include spf-size-rd(#{$sz}#{$mu}, $ri, true);
                            }
                        }
                    }
                } @else {
                    /** 正常的 trbl 循环 **/
                    @each $pi in $trblQueue {
                        @if $target == self {
                            //&.pd-xs.pd-tbl
                            &.#{$pre}#{$sz}#{$mu}.#{$pre}#{$pi} {
                                @include spf-size-po(#{$sz}#{$mu}, $pi, $prop, true);
                            }
                        } @else if $target == child {
                            //& .pd-xs.pd-tbl
                            & .#{$pre}#{$sz}#{$mu}.#{$pre}#{$pi} {
                                @include spf-size-po(#{$sz}#{$mu}, $pi, $prop, true);
                            }
                        }
                    }
                }
            }
        }
    }
}
/** 为 当前类 或 后代类 指定 通用的字体样式 **/
@mixin spf-fo-shift($target: self, $manual: (24,32,48,54,64,72,80,96,128)) {
    $prop-pre: if($target == self, unquote("&."), unquote("& ."));
    //颜色循环 .fc-red-m .fc-primary-d3
    @include spf-color-shift($target, 'fc-', color, fc);
    //尺寸循环 .fs-m .fs-xl .fs-32px 
    @include spf-size-shift($target, 'fs-', font-size, fs, $manual, false);
    //字重循环 .fw-xl .fw-m
    @include spf-size-shift($target, 'fw-', font-weight, fw, (100,200,300,400,500,600,700,800,900), false);
    //字重快捷类 .fw-normal|bold|thin
    #{$prop-pre}fw-normal { font-weight: $size-fw-m !important; }
    #{$prop-pre}fw-bold { font-weight: $size-fw-xl !important; }
    #{$prop-pre}fw-thin { font-weight: $size-fw-xs !important; }
    //字体族 .fml-default|code...
    $fmls: map-filter-keys($varsMap, font-fml);
    $fmlks: map.keys($fmls);
    @each $k in $fmlks {
        //font-fml-foobar --> fml-foobar
        $ki: str-sub($k, 6);
        $kv: map.get($fmls, $k);
        #{$prop-pre}#{$ki} {font-family: unquote($kv) !important;}
    }

    //其他通用字体样式
    //链接字体样式 .f-a
    #{$prop-pre}f-a {
        @include spf-a(primary);
    }
    //高亮字体 .f-highlight
    #{$prop-pre}f-highlight {
        box-sizing: border-box;
        padding: .2em .3em !important;
        margin: 0 .3em !important;
        border: {
            radius: .2em !important;
            width: 0 !important;
        }
        background-color: $color-warn-l3 !important;
        color: $color-warn-l3-fc !important;
        &.hl-border {
            border: {
                width: 1px !important;
                color: $color-warn-l2 !important;
            }
        }
        @each $hc in $typeList {
            $hcv: color-get(#{$hc}-l3);
            $hfcv: color-get(#{$hc}-l3-fc);
            $hbcv: color-get(#{$hc}-l2);
            @if $hcv != null {
                &.hl-#{$hc} {
                    background-color: $hcv !important;
                    color: $hfcv !important;
                    &.hl-border {
                        border-color: $hbcv !important;
                    }
                }
            }
        }
    }
    //codex 代码字体
    #{$prop-pre}f-code {
        padding: .2em .3em !important;
        margin: 0 .3em !important;
        border: {
            radius: .2em !important;
            width: 0 !important;
        }
        background-color: $color-gray-l3 !important;
        color: $color-primary-d3 !important;
        font-family: $font-fml-code;
    }
    //.f-ellipsis
    #{$prop-pre}f-ellipsis {
        @include spf-text-ellipsis;
    }
}
/** 为 当前类 或 后代类 指定 通用的边框样式 可手动指定 border-width|radius 尺寸 list **/
@mixin spf-bd-shift($target: self, $width: null, $radius: null) {
    $prop-pre: if($target == self, unquote("&"), unquote("& "));
    //颜色循环 .bdc-red-d2 .bdc-m
    @include spf-color-shift($target, 'bdc-', border-color, bdc);
    #{$prop-pre}[class*=bdc-] {
        border: {
            style: solid;
            width: $size-bd-m;
        }
    }
    //尺寸循环|位置循环 .bd-m .bd-m.bd-rl .bd-m.bd-xy
    @include spf-size-shift($target, 'bd-', border-width, bd, $width);
    #{$prop-pre}[class*=bd-] {
        border: {
            style: solid;
            color: $color-bdc-m;
        }
    }
    //圆角循环 .rd-m|xl..
    @include spf-size-shift($target, 'rd-', border-radius, rd, $radius);
}
/** 为 当前类 或 后代类 指定 通用的 padding 样式 **/
@mixin spf-pd-shift($target: self, $manual: null) {
    //尺寸循环|位置循环 .pd-m .pd-s.pd-rl .pd-xl.pd-xy
    @include spf-size-shift($target, 'pd-', padding, pd, $manual);
}
/** 为 当前类 或 后代类 指定 通用的 margin 样式 **/
@mixin spf-mg-shift($target: self, $manual: null) {
    //尺寸循环|位置循环 .mg-m .mg-s.mg-rl .mg-xl.mg-xy
    @include spf-size-shift($target, 'mg-', margin, mg, $manual);
}
/** 为 当前类 或 后代类 指定 通用的 background 样式 **/
@mixin spf-bg-shift($target: self, $blur: null) {
    $prop-pre: if($target == self, unquote("&."), unquote("& ."));
    //颜色循环|透明度循环 .bgc-red-d2 .bgc-m .bgc-primary-l1.bgc-a6
    @include spf-color-shift($target, 'bgc-', border-color, bgc, true);
    //backdrop-filter: blur()
    @if $blur == null {$blur: size-get(blur-m);}
    //.bg-blur
    #{$prop-pre}bg-blur {
        backdrop-filter: blur($blur);
    }
}
/** 为 当前类 或 后代类 指定 通用的 opacity 样式 **/
@mixin spf-opa-shift($target: self) {
    $prop-pre: if($target == self, unquote("&."), unquote("& ."));
    @for $opi from 1 through 10 {
        $opik: $opi * 10;
        $opiv: $opi / 10;
        //.opa-10|20|100...
        #{$prop-pre}opa-#{$opik} {
            opacity: $opiv !important;
        }
    }
}
/** 为 当前类 或 后代类 指定 通用的 shadow 样式 **/
@mixin spf-shadow-shift($target: self, $manual: null) {
    $prop-pre: if($target == self, unquote("&."), unquote("& ."));
    //阴影颜色固定，自带透明度
    $sdc: $color-shadow-m;
    //阴影尺寸 自动计算
    @each $qi in $sizeShiftQueue {
        $sz: size-get(shadow-#{$qi});
        @if is-number($sz) {
            $x: div($sz, 2);
            $y: $sz;
            $blur: add($sz, set-unit(8, unit($sz)));
            //.shadow-m|xl
            #{$prop-pre}shadow-#{$qi} {
                box-shadow: #{$x} #{$y} #{$blur} #{$sdc};
            }
        }
    }
}



 /** 初始化 body 样式 **/
body, view, .page {
    margin: 0; padding: 0;
    //后代元素的 margin|padding 样式
    @include spf-mg-shift(child);
    @include spf-pd-shift(child);

    //默认字体
    font: {
        size: $size-fs-m;
        weight: $size-fw-m;
        family: $font-fml-default;
    }
    color: $color-fc-m;
    //后代元素的字体样式
    @include spf-fo-shift(child);

    //默认背景
    background-color: $color-bgc-m;
    //后代元素的背景样式
    @include spf-bg-shift(child);

    //默认的边框样式
    border: {
        width: 0;
        style: solid;
        color: transparent;
        radius: 0;
    }
    //后代元素的 边框样式
    @include spf-bd-shift(child);

    //后代元素的 特殊样式
    //opacity
    @include spf-opa-shift(child);
    //shadow
    @include spf-shadow-shift(child);
}

//通用 flex 样式
.flex-x {@include spf-flex-x($gap: $size-mg-m);}
.flex-y {@include spf-flex-y($gap: $size-mg-m);}

//通用 svg-icon 样式
.icon {
    width: 1em; height: 1em;
    //vertical-align: -0.15em;
    //margin-top: 0.05em;
    fill: currentColor;
    overflow: hidden;
    transition: all $ani-dura;

    //默认 size
    font-size: $size-icon-m;

    //默认 color
    color: $color-fc-m;

    //尺寸循环
    @each $si in $sizeStrQueue {
        $ski: map.get($sizeStrMap, $si);
        $sk: icon-#{$ski};
        $sz: size-get($sk);
        @if is-number($sz) {
            &.icon-#{$si}, &.#{$sk} {
                font-size: $sz;
            }
        }
    }
    @each $si in $sizeShiftQueue {
        $sk: icon-#{$si};
        $sz: size-get($sk);
        @if is-number($sz) {
            &.#{$sk} {
                font-size: $sz;
            }
        }
    }
    //手动 icon 尺寸循环
    $u: unit($size-icon-m);
    @each $sn in $extraIconSizeQueue {
        @if is-number($sn) {
            $sk: if(is-digit($sn), set-unit($sn, $u), $sn);
            &.icon-#{$sk} {
                font-size: $sk;
            }
        }
    }

    //颜色循环
    @each $ci in $colorListAll {
        $cvm: color-get(#{$ci}-m);
        @if is-color($cvm) {
            &.icon-#{$ci} {
                color: $cvm;
            }
            @each $si in $colorShiftQueue {
                $ck: #{$ci}-#{$si};
                $cvk: color-get($ck);
                @if is-color($cvk) {
                    &.icon-#{$ck} {
                        color: $cvk;
                    }
                }
            }
        }
    }
}

//通用 button 样式
.btn {
    @include spf-po-ov($w: unset, $h: btn-m, $pd: 0 pd-m, $mg: 0);
    min-width: $size-btn-m;
    @include spf-flex-x-noinner($x: center);
    font: {
        size: $size-fs-m;
        weight: $size-fw-m;
        family: $font-fml-default;
    }
    border: {
        style: solid;
        width: 1px;
    }
    cursor: pointer;
    transition: background-color $ani-dura,
                border-color $ani-dura,
                transform .1s;
    
    //icon 图标默认样式
    &>svg[class*=icon] {
        cursor: pointer;
        transition: color .1s;
    }

    &>label {
        //margin-top: -0.1em;
        @include spf-text-ellipsis;
        overflow: unset;
        cursor: pointer;
        transition: color .1s,
                    text-underline-offset .1s;
    }
    //在 表格单元格中
    &.btn-incell>label {
        width: 0; text-align: center;
    }
    //当作页面标题
    &.btn-astitle>label {
        font-weight: bold;
        font-size: 1.2em;
    }

    //默认的 btn-size 包含 btn-shape-*|btn-stretch-*
    @include spf-bar-size(self, 'btn-', btn-m, true, true, false);

    //默认 effect
    @include spf-effect(self, 'btn-', null);

    //disabled 状态
    &.btn-disabled {
        opacity: 0.3;
        cursor: not-allowed;
        &>svg[class*=icon] {cursor: not-allowed;}
        &>label {cursor: not-allowed;}
    }
    //按下状态
    &.btn-mouse-down {
        transform: scale(0.9);
    }

    //链接形式的 btn
    &.btn-link {
        //默认链接形式
        &>label {
            @include spf-a(primary, true);
        }

    }

    //尺寸循环
    @each $si in $sizeStrQueue {
        $ski: map.get($sizeStrMap, $si);
        $sk: btn-#{$ski};
        $sz: size-get($sk);
        @if is-number($sz) {
            &.btn-#{$si}, &.#{$sk} {
                //设置当前 btn-size 包含 btn-shape-*|btn-stretch-*
                @include spf-bar-size(self, 'btn-', $sz, true, true, false);
                    
                //
            }
        }
    }
    @each $si in $sizeShiftQueue {
        $sk: btn-#{$si};
        $sz: size-get($sk);
        @if is-number($sz) {
            &.#{$sk} {
                //设置当前 btn-size 包含 btn-shape-*|btn-stretch-*
                @include spf-bar-size(self, 'btn-', $sz, true, true, false);
            }
        }
    }
    //extraSizeQueue
    $u: unit($size-btn-m);
    @each $sn in $extraBtnSizeQueue {
        @if is-number($sn) {
            $sz: if(is-digit($sn), set-unit($sn, $u), $sn);
            &.btn-#{$sz} {
                //设置当前 btn-size 包含 btn-shape-*|btn-stretch-*
                @include spf-bar-size(self, 'btn-', $sz, true, true, false);
            }
        }
    }

    //颜色循环
    @each $ti in $typeList {
        $ck: #{$ti}-m;
        $cv: color-get($ck);
        @if is-color($cv) {
            &.btn-#{$ti} {
                //当前颜色下的 effect 样式
                @include spf-effect(self, 'btn-', $ti);
            }
        }
    }
    @each $ci in $colorListAll {
        @if not has($typeList, $ci) {
            $ck: #{$ci}-m;
            $cv: color-get($ck);
            @if is-color($cv) {
                &.btn-#{$ci} {
                    //当前颜色下的 effect 样式
                    @include spf-effect(self, 'btn-', $ci);
                }
            }
        }
    }
}



//自定义 scroll-bar 样式
.scroll, .scroll-y {
    @include spf-scroll;
    .scroll-thin {@include spf-scroll($size: 4px);}
    .scroll-bold {@include spf-scroll($size: 8px);}
}
.scroll-x {
    @include spf-scroll($ov: auto hidden);
    .scroll-thin {@include spf-scroll($size: 4px, $ov: auto hidden);}
    .scroll-bold {@include spf-scroll($size: 8px, $ov: auto hidden);}
}